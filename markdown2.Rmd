---
title: "The Impact of Inbreeding and thoracic development on Flight Performance in *Bicyclus anynana*: Fitness Consequences and Conservation Implications"
author: "Hanna Aarvold-Riley"
date: "2024-08-05"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r source script, include=FALSE}
source("butterflies.R")

```

intro
hypothesis

analysis

results and discussion
para 1


``` {r, include=TRUE}
figure1

```
``` {r, include=TRUE}
figure2

```
para 2
``` {r, include=TRUE}
figure3

```
``` {r, include=TRUE}
figure4

```

conclusion

## Bibliography

Armbruster, P., Hutchinson, R.A. and Linvell, T. (2000) ‘Equivalent inbreeding depression under laboratory and field conditions in a tree-hole-breeding mosquito’, *Proceedings of the Royal Society of London. Series B: Biological Sciences*, 267(1456), pp. 1939–1945. doi:10.1098/rspb.2000.1233.  

Charlesworth, D. and Charlesworth, B. (1987) ‘Inbreeding depression and its evolutionary consequences’, *Annual Review of Ecology and Systematics*, 18(1), pp. 237–268. doi:10.1146/annurev.ecolsys.18.1.237.  

Falconer, D.S. and Mackay, T.F.C. (1996) *Introduction to quantitative genetics*. London, UK: Longman.  

Firke, S., 2023. *janitor*: Simple Tools for Examining and Cleaning Dirty Data. R package version 2.2.0. Available at: https://CRAN.R-project.org/package=janitor. 

Frankham, R. (2005) ‘Genetics and extinction’, *Biological Conservation*, 126(2), pp. 131–140. doi:10.1016/j.biocon.2005.05.002.  

Joron, M. and Brakefield, P.M. (2003) ‘Captivity masks inbreeding effects on male mating success in butterflies’, *Nature*, 424(6945), pp. 191–194. doi:10.1038/nature01713.   

Keller, L. and Waller, D. (2002) ‘Inbreeding effects in wild populations’, *Trends in Ecology and Evolution*, 17(5), pp. 230–241. doi:10.1016/s0169-5347(02)02489-8.   

Saccheri, I. et al. (1998) ‘Inbreeding and extinction in a butterfly metapopulation’, *Nature*, 392(6675), pp. 491–494. doi:10.1038/33136.  

Srygley, R.B. and Chai, P. (1990) ‘Flight morphology of neotropical butterflies: Palatability and distribution of mass to the thorax and abdomen’, *Oecologia*, 84(4), pp. 491–499. doi:10.1007/bf00328165.  

Tigreros, N. and Davidowitz, G. (2019) ‘Flight-fecundity tradeoffs in wing-monomorphic insects’, *Advances in Insect Physiology*, 56, pp. 1–41. doi:10.1016/bs.aiip.2019.02.001.  

Travis, J.M. et al. (2013) ‘Dispersal and species’ responses to climate change’, *Oikos*, 122(11), pp. 1532–1540. doi:10.1111/j.1600-0706.2013.00399.x.  

Valenzuela‐Aguayo, F. et al. (2019) ‘Human‐induced habitat fragmentation effects on connectivity, diversity, and population persistence of an endemic fish, percilia irwini, in the Biobío River Basin (chile)’, *Evolutionary Applications*, 13(4), pp. 794–807. doi:10.1111/eva.12901.  

Wickham, H., 2016. ggplot2: Elegant Graphics for Data Analysis. R package version 3.4.0. Available at: https://CRAN.R-project.org/package=ggplot2.

Wickham, H., 2017. *tidyverse*: Easily Install and Load the 'Tidyverse'. R package version 1.2.1. Available at: https://CRAN.R-project.org/package=tidyverse.  

Wickham, H., François, R., Henry, L. and Müller, K., 2023. *dplyr*: A Grammar of Data Manipulation. R package version 1.1.2. Available at: https://CRAN.R-project.org/package=dplyr.  

Wright, S. (1922) ‘Coefficients of inbreeding and relationship’, *The American Naturalist*, 56, pp. 491–494. Available at: http://www.jstor.org/stable/10.2307/2456273?refreqid=fastly-default (Accessed: 05 August 2024).  

Zhu, H., 2021. *kableExtra*: Construct Complex Table with 'kable' and Pipe Syntax. R package version 1.3.4. Available at: https://CRAN.R-project.org/package=kableExtra.  


## Appendix: R Code

```{r appendix, eval=FALSE, echo=TRUE}

rm(list=ls()) #start with a clear environment


# An Analysis of the impact of inbreeding on flight inhibition in Bicyclus anynana----

#________________----

## PACKAGES ----

library(tidyverse) # tidy data packages
library(janitor) # clean data names
library(dplyr) # data manipulation
library(kableExtra) # present tables
library(ggplot2) # produce plots

## IMPORT DATA ----
butterflies <- read_csv("data/inbreeding_butterfly.csv")

head(butterflies) #check data has loaded

# TIDYING ----

butterflies_wide <- pivot_wider(data = butterflies,
                                names_from = body_part,
                                values_from = dry_weight) #pivot to wide format to make fitting lm easier

# column names

colnames(butterflies_wide) #view column names

butterflies_tidy <- clean_names(butterflies_wide) #change column names to snake_case

butterflies_tidy <- rename(butterflies_tidy,
                           "inbreed_coeff" = "ic",
                           "flight_inhibit_idx" = "fii",
                           "thorax_mg" = "drythor",
                           "rest_mg" = "dryrest",
                           "total_mg" = "drytotal") #rename column names to be informative and concise

glimpse(butterflies_tidy) #check new column names


# check for errors in data

butterflies_tidy %>%
  duplicated() %>%
  sum() #check for duplicated data


butterflies_tidy %>%
  is.na() %>%
  sum() #check for missing data


butterflies_tidy %>%
  summarise(min=min(flight_inhibit_idx, na.rm=TRUE), 
            max=max(flight_inhibit_idx, na.rm=TRUE)) #check for typos in fii
butterflies_tidy <- butterflies_tidy %>%
  filter(flight_inhibit_idx != "660") #filter out row with error in fii


butterflies_tidy %>%
  summarise(min=min(total_mg, na.rm=TRUE),
            max=max(total_mg, na.rm=TRUE)) #check for typos in weights of body parts

print(butterflies_tidy %>% 
        distinct(inbreed_coeff))#check for typos in inbreeding coefficient (there should only be 3 levels of ic)

#_____________________----

# EXPLORATORY ANALYSIS ----

ggplot(data = butterflies_tidy,
       aes(x = inbreed_coeff,
           y = flight_inhibit_idx))+
  geom_jitter() #ic vs fii - appears to be a correlation

ggplot(data = butterflies_tidy, aes(x = inbreed_coeff)) +
  geom_jitter(aes(y = total_mg, color = "total_mg")) +
  geom_jitter(aes(y = rest_mg, color = "rest_mg")) +
  geom_jitter(aes(y = thorax_mg, color = "thorax_mg")) #ic vs thorax/rest/total dry weights - no apparent correlation visible


ggplot(data = butterflies_tidy, aes(x = flight_inhibit_idx)) +
  geom_jitter(aes(y = total_mg, color = "total_mg")) +
  geom_jitter(aes(y = rest_mg, color = "rest_mg")) +
  geom_jitter(aes(y = thorax_mg, color = "thorax_mg")) #fii vs thorax/rest/total dry weight - appears to be correlation most prominantly in thorax_mg


#_____________________----

# LINEAR MODEL ----

butterflies_lm8 <- lm(flight_inhibit_idx ~ inbreed_coeff + thorax_mg, data = butterflies_tidy)#fit linear model

performance::check_model((butterflies_lm8))#check assumptions of lm

summary(butterflies_lm8)#print summary for analysis

broom::tidy(butterflies_lm8, conf.int = TRUE) #add confidence intervals

anova(butterflies_lm8) #perform anova on the model

#_______________________------

# FIGURES ----

## figure 1: jitter plot of inbreeding coefficient vs flight inhibition index ----

figure1 <- ggplot(data = butterflies_tidy, aes(x = factor(inbreed_coeff), y = flight_inhibit_idx)) +
  geom_jitter(aes(color = factor(inbreed_coeff)), width = 0.4, height = 0, alpha = 0.6, size = 2.5) +  #jitter plot
  scale_color_manual(values = c("0" = '#1F9E89', "0.25" = '#31688E', "0.375" = '#440154'),) +  #accessible colours
  labs(title = "Flight Inhibition Index Across Levels of Inbreeding Coefficient", #title
       x = "Inbreeding Coefficient Level", #axis labels
       y = "Flight Inhibition Index",
       colour = "Inbreeding Coefficient") +
  theme_minimal() + 
  scale_y_continuous(breaks = seq(0, ceiling(max(butterflies_tidy$flight_inhibit_idx)), by = 5)) + #y axis line breaks
  theme( panel.grid.major.y = element_line(color = "grey", size = 0.2),  #appearance of line breaks
         panel.grid.minor = element_blank(), #remove minor lines
         legend.title = element_text(size = 12),  #make more aesthetically pleasing
         legend.text = element_text(size = 8),
         axis.title.y = element_text(size=14),
         axis.title.x = element_text(size=14))

# figure 2: summary of linear model ----

figure2 <- broom::tidy(butterflies_lm8, conf.int = TRUE) %>% #tidy and add confidence intervals
  kbl(caption = "Summary of Linear Model", digits = 3) %>% #figure legend
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  kable_styling(bootstrap_options = c("bordered")) #make more aesthetically pleasing


# figure 3: scatter plot of thorax weight vs flight inhibition index ---- 

figure3 <- ggplot(data = butterflies_tidy, aes(x = thorax_mg, y = flight_inhibit_idx)) +
  geom_point(aes(color = factor(inbreed_coeff)), size = 1.8, alpha = 0.85) +  #scatter plot
  geom_smooth(method = "lm", se = FALSE, color = "#440154") +  # Add a regression line
  scale_color_manual(values = c("0" = '#1F9E89', "0.25" = '#6DCD59', "0.375" = '#3E4989')) +  #accessible colours
  labs(title = "Scatter Plot of Thorax Dry Weight vs Flight Inhibition Index", #titles
       x = "Thorax Dry Weight (mg)",
       y = "Flight Inhibition Index",
       colour = "Inbreeding Coefficient") +
  theme_minimal() + 
  scale_y_continuous(breaks = seq(0, ceiling(max(butterflies_tidy$flight_inhibit_idx)), by = 10)) +  #yaxis breaks line breaks
  theme(legend.title = element_text(size = 12),  #make titles more balanced
        legend.text = element_text(size = 10),  
        axis.title.x = element_text(size = 14), 
        axis.title.y = element_text(size = 14)) 

# figure 4: anova table ----

figure4 <- anova(butterflies_lm8) %>%
  as.data.frame() %>%
  `rownames<-`(c("Inbreeding Coefficient", "Thorax Dry Weight (mg)", "Residuals")) %>%
  kbl(caption = "ANOVA Table", digits = 3) %>%
  kable_styling(bootstrap_options = c("striped", "bordered"))

