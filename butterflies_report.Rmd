---
title: "An analysis of the impact of inbreeding on flight inhibition in *Bicyclus anynana*."
author: "Hanna Aarvold-Riley"
date: "`r Sys.Date()`"
output:
  pdf_document:
    extra_dependencies: ["flafter"]
    fig_caption: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
  message = FALSE,
  fig.pos = "H",
  out.extra = "")
```

```{r library, include=FALSE}
library(tidyverse) # tidy data packages
library(janitor) # clean data names
library(dplyr) # data manipulation
library(kableExtra) # present tables
library(ggplot2) # produce plots
```

```{r source script, include=FALSE}
source("butterflies.R")

```

## Introduction
Inbreeding depression refers to the reduced fitness observed in the offspring of inbreeding individuals from typically outbreeding populations. This decline in fitness is caused by reduced genetic diversity and increased levels of homozygosity, resulting in higher levels of expression of recessive deleterious alleles. Deleterious alleles negatively impact fitness-related traits which are usually somewhat masked in populations with higher heterozygosity (Frankham, 2005) (Keller & Waller, 2002). Susceptibility to inbreeding depression is highly variable between species (Charlesworth & Charlesworth, 1987), but is expected to be directly proportional to inbreeding coefficient – a numerical measure of the degree of inbreeding in an individual (Falconer & Mackay, 1996) (Wright, 1922). This study will use *Bicyclus anynana*, a species of butterfly found in Eastern Africa which is commonly used as a model organism and has previously been reported to be particularly susceptible to the effects of inbreeding depression (Saccheri *et al.*, 1998).  Butterflies, like many organisms, rely on flight for various essential activities including feeding and predator-evasion, hence impact in flight-related traits may significantly affect fitness. 

#### $H_{1}$=Individuals of *Bicyclus anynana* with higher inbreeding coefficients will exhibit increased flight inhibition indexes.

## Analysis

This analysis examines the effect of inbreeding on flight inhibition in *Bicyclus anynana*. The primary question I aim to address is whether higher inbreeding coefficients are associated with increased flight inhibition. Understanding this relationship is crucial for assessing the immediate impact of inbreeding on butterfly flight capabilities and broader implications for their fitness and conservation. 
To address the hypothesis, I used a data set which included the inbreeding coefficient (F), flight inhibition index (measured by number of times the butterfly settled during a 2 minute period of stimulation), and the dry weight of the thorax, rest of body and total body of 313 individuals.  
A multiple linear regression model was applied which used inbreeding coefficient and thorax dry weight as predictors of flight inhibition index. The best fitting model did not include any interaction terms and excluded the rest of body weight. Total body weight was excluded to avoid multicollinearity.  
No transformations were necessary as the relationships between independent, dependent variables were linear, and the residuals met the assumptions of normality and homoscedasticity. The data set was screened for errors and one individual was excluded.   
I subsequently conducted an analysis of variance to evaluate the significance of the predictors in the model. All analysis was conducted using R version 4.4.1.

\newpage

## Results and Discussion
#### Inbreeding coefficient proportional to flight inhibition index  

I hypothesised that individuals with higher inbreeding coefficients would exhibit higher flight inhibition indexes. To test this hypothesis, I fitted a multiple linear regression model, including inbreeding coefficient and thorax weight as predictors, to assess their individual contributions to flight inhibition index. This analysis showed that individuals with higher inbreeding coefficients have on average a 20.7 unit increase in flight inhibition index (95% CI: 9.0-32.4) compared to those with lower inbreeding coefficients (F1,309 = 14.34, P < 0.001, R² = 0.058, Figure 1, Table 1). These findings indicate increased homozygosity resulting from inbreeding depression inhibits flight performance, a key fitness-related trait, and I can reject the null hypothesis. This underscores the importance of maintaining genetic diversity within butterfly Lepidoptera populations and has implications for vulnerable and endangered butterfly species where populations are small, and inbreeding is most likely to occur.  


```{r, include=TRUE, fig.cap="The impact of inbreeding coefficient on flight inhibition index in Bicyclus anynana. The scatter plot illustrates the relationship between the inbreeding coefficient (F) and the flight inhibition index (measured as the number of times butterflies settled during a 2-minute stimulation period). Each point represents an individual butterfly, with colors corresponding to different levels of the inbreeding coefficient: F = 0 (green), F = 0.25 (blue), and F = 0.375 (purple); a higher F indicates greater degree of inbreeding. The plot includes a linear regression line fitted to the data, showing a significant positive relationship between inbreeding coefficient and flight inhibition index (F1,309 = 14.34, P < 0.001, R² = 0.058). The shaded area around the regression line represents the 95% confidence interval of the fitted model. This suggests that higher inbreeding coefficients are associated with increased flight inhibition."}
figure1

```
``` {r, include=TRUE,}
figure2

```
\newpage

### Thorax dry weight as a predictor of flight inhibition index

Several models were trialed with different variables included while finding the best fitting multiple linear regression model, with the accepted model including thorax dry weight as a predictor in addition to inbreeding coefficient and excluding rest of body weight. The analysis of variance (Table 2) for the chosen model showed that thorax dry weight has on average a 3.1 unit decrease in flight inhibition index per mg increase in thorax mass (95% CI: -5.92 to -0.28) (F1,309 = 4.69, P = 0.031, R² = 0.058, Figure 2). The thorax contains predominantly flight muscles and greater thoracic mass is positively associated with flight performance (Srygley & Chai, 1990) so this result is not unexpected. Further research should investigate the relationship between genetic diversity and thoracic muscle development to better understand the mechanism by which inbreeding depression affects flight inhibition.

``` {r, include=TRUE, fig.cap="Relationship between Thorax Dry Weight and Flight Inhibition Index in Bicyclus anynana. This scatter plot illustrates the correlation between thorax dry weight in mg and flight inhibition index in Bicyclus anynana. Each point represents an individual butterfly, with a linear regression line fitted to the data. The plot shows a significant negative relationship, suggesting that increased thorax dry weight is associated with reduced flight inhibition. The shaded area around the regression line denotes the 95% confidence interval, highlighting the precision of the fitted model."}
figure3
```
``` {r, include=TRUE}
figure4

```
\newpage

Fitness is commonly defined as an organism’s ability to survive and reproduce in a particular environment, and previous research on inbreeding depression in insects has largely focused on traits closely related to egg-laying and larval hatching. This study begins to bridge the gap into fitness traits which are less directly related to reproduction but still vital to survival. This has huge implications for conservation efforts, particularly as the ability to disperse becomes increasingly essential for survival in rapidly changing and fragmenting habitats. (Valenzuela‐Aguayo *et al.*, 2019) (Travis *et al.*, 2013). Additionally, a 2019 review by Tigreros and Davidowitz (Tigreros & Davidowitz, 2019) identified significant flight-fecundity trade-offs, suggesting that further research should aim to understand whether inbreeding is an aggravating factor in the allocation of energy between survival and reproduction in insects. This will have important implications for conservation and recovery of struggling populations which are most at risk of inbreeding.  
Furthermore, Armbruster et al. (2002) compared inbreeding depression in mosquitoes in laboratory and field settings and concluded that the effects of inbreeding were no more extreme in the field than in the lab. However, this is contested, with one study finding inbreeding depression effects were greatly accentuated in the wild compared to the lab (Joron & Brakefield, 2003) . Therefore, replicating this study in the field would be necessary to fully understand the effects of inbreeding on flight inhibition.

## Conclusion

This study revealed that higher inbreeding coefficients are associated with a significant increase in flight inhibition index in *Bicyclus anynana*, confirming that inbreeding depression negatively impacts flight performance. Additionally, it found that thorax weight has a significant negative correlation with flight inhibition, indicating that thoracic development plays a role in flight ability.  
These findings contribute to our understanding of the deleterious effects of inbreeding in naturally outbreeding populations. The increased homozygosity due to inbreeding results in the expression of recessive deleterious alleles, which impair critical fitness traits such as flight performance. This study underscores the necessity of maintaining genetic diversity to preserve the functional and ecological viability of butterfly populations.To advance the field, future research should delve into the genetic underpinnings of these observed effects. Identifying specific alleles responsible for flight inhibition can provide targeted strategies for conservation efforts. Additionally, exploring potential adaptive mechanisms, such as selective breeding or habitat modifications to promote outbreeding, could enable conservationists to mitigate the negative impacts of inbreeding. Comparing findings across different butterfly species and other taxa could also offer broader insights into the universal patterns of inbreeding depression and its ecological consequences. Integrating these approaches will enhance our ability to develop comprehensive conservation strategies, ensuring the survival and health of butterfly populations in changing environments.
\newpage

## Bibliography

Armbruster, P., Hutchinson, R.A. and Linvell, T. (2000) ‘Equivalent inbreeding depression under laboratory and field conditions in a tree-hole-breeding mosquito’, *Proceedings of the Royal Society of London. Series B: Biological Sciences*, 267(1456), pp. 1939–1945. doi:10.1098/rspb.2000.1233.  

Charlesworth, D. and Charlesworth, B. (1987) ‘Inbreeding depression and its evolutionary consequences’, *Annual Review of Ecology and Systematics*, 18(1), pp. 237–268. doi:10.1146/annurev.ecolsys.18.1.237.  

Falconer, D.S. and Mackay, T.F.C. (1996) *Introduction to quantitative genetics*. London, UK: Longman.  

Firke, S., 2023. *janitor*: Simple Tools for Examining and Cleaning Dirty Data. R package version 2.2.0. Available at: https://CRAN.R-project.org/package=janitor. 

Frankham, R. (2005) ‘Genetics and extinction’, *Biological Conservation*, 126(2), pp. 131–140. doi:10.1016/j.biocon.2005.05.002.  

Joron, M. and Brakefield, P.M. (2003) ‘Captivity masks inbreeding effects on male mating success in butterflies’, *Nature*, 424(6945), pp. 191–194. doi:10.1038/nature01713.   

Keller, L. and Waller, D. (2002) ‘Inbreeding effects in wild populations’, *Trends in Ecology and Evolution*, 17(5), pp. 230–241. doi:10.1016/s0169-5347(02)02489-8.   

Saccheri, I. et al. (1998) ‘Inbreeding and extinction in a butterfly metapopulation’, *Nature*, 392(6675), pp. 491–494. doi:10.1038/33136.  

Srygley, R.B. and Chai, P. (1990) ‘Flight morphology of neotropical butterflies: Palatability and distribution of mass to the thorax and abdomen’, *Oecologia*, 84(4), pp. 491–499. doi:10.1007/bf00328165.  

Tigreros, N. and Davidowitz, G. (2019) ‘Flight-fecundity tradeoffs in wing-monomorphic insects’, *Advances in Insect Physiology*, 56, pp. 1–41. doi:10.1016/bs.aiip.2019.02.001.  

Travis, J.M. et al. (2013) ‘Dispersal and species’ responses to climate change’, *Oikos*, 122(11), pp. 1532–1540. doi:10.1111/j.1600-0706.2013.00399.x.  

Valenzuela‐Aguayo, F. et al. (2019) ‘Human‐induced habitat fragmentation effects on connectivity, diversity, and population persistence of an endemic fish, percilia irwini, in the Biobío River Basin (chile)’, *Evolutionary Applications*, 13(4), pp. 794–807. doi:10.1111/eva.12901.  

Wickham, H., 2016. ggplot2: Elegant Graphics for Data Analysis. R package version 3.4.0. Available at: https://CRAN.R-project.org/package=ggplot2.

Wickham, H., 2017. *tidyverse*: Easily Install and Load the 'Tidyverse'. R package version 1.2.1. Available at: https://CRAN.R-project.org/package=tidyverse.  

Wickham, H., François, R., Henry, L. and Müller, K., 2023. *dplyr*: A Grammar of Data Manipulation. R package version 1.1.2. Available at: https://CRAN.R-project.org/package=dplyr.  

Wright, S. (1922) ‘Coefficients of inbreeding and relationship’, *The American Naturalist*, 56, pp. 491–494. Available at: http://www.jstor.org/stable/10.2307/2456273?refreqid=fastly-default (Accessed: 05 August 2024).  

Zhu, H., 2021. *kableExtra*: Construct Complex Table with 'kable' and Pipe Syntax. R package version 1.3.4. Available at: https://CRAN.R-project.org/package=kableExtra.  

\newpage

## Appendix: R Code

```{r appendix, eval=FALSE, echo=TRUE}

rm(list=ls()) #start with a clear environment


# An Analysis of the impact of inbreeding on flight inhibition in Bicyclus anynana----

#________________----

## PACKAGES ----

library(tidyverse) # tidy data packages
library(janitor) # clean data names
library(dplyr) # data manipulation
library(kableExtra) # present tables
library(ggplot2) # produce plots

## IMPORT DATA ----
butterflies <- read_csv("data/inbreeding_butterfly.csv")

head(butterflies) #check data has loaded

# TIDYING ----

butterflies_wide <- pivot_wider(data = butterflies,
                                names_from = body_part,
                                values_from = dry_weight) #pivot to wide format to make fitting lm easier

# column names

colnames(butterflies_wide) #view column names

butterflies_tidy <- clean_names(butterflies_wide) #change column names to snake_case

butterflies_tidy <- rename(butterflies_tidy,
                           "inbreed_coeff" = "ic",
                           "flight_inhibit_idx" = "fii",
                           "thorax_mg" = "drythor",
                           "rest_mg" = "dryrest",
                           "total_mg" = "drytotal") #rename column names to be informative and concise

glimpse(butterflies_tidy) #check new column names


# check for errors in data

butterflies_tidy %>%
  duplicated() %>%
  sum() #check for duplicated data


butterflies_tidy %>%
  is.na() %>%
  sum() #check for missing data


butterflies_tidy %>%
  summarise(min=min(flight_inhibit_idx, na.rm=TRUE), 
            max=max(flight_inhibit_idx, na.rm=TRUE)) #check for typos in fii
butterflies_tidy <- butterflies_tidy %>%
  filter(flight_inhibit_idx != "660") #filter out row with error in fii


butterflies_tidy %>%
  summarise(min=min(total_mg, na.rm=TRUE),
            max=max(total_mg, na.rm=TRUE)) #check for typos in weights of body parts

print(butterflies_tidy %>% 
        distinct(inbreed_coeff))#check for typos in inbreeding coefficient (there should only be 3 levels of ic)

#_____________________----

# EXPLORATORY ANALYSIS ----

ggplot(data = butterflies_tidy,
       aes(x = inbreed_coeff,
           y = flight_inhibit_idx))+
  geom_jitter() #ic vs fii - appears to be a correlation

ggplot(data = butterflies_tidy, aes(x = inbreed_coeff)) +
  geom_jitter(aes(y = total_mg, color = "total_mg")) +
  geom_jitter(aes(y = rest_mg, color = "rest_mg")) +
  geom_jitter(aes(y = thorax_mg, color = "thorax_mg")) #ic vs thorax/rest/total dry weights - no apparent correlation visible


ggplot(data = butterflies_tidy, aes(x = flight_inhibit_idx)) +
  geom_jitter(aes(y = total_mg, color = "total_mg")) +
  geom_jitter(aes(y = rest_mg, color = "rest_mg")) +
  geom_jitter(aes(y = thorax_mg, color = "thorax_mg")) #fii vs thorax/rest/total dry weight - appears to be correlation most prominantly in thorax_mg


#_____________________----

# LINEAR MODEL ----

butterflies_lm8 <- lm(flight_inhibit_idx ~ inbreed_coeff + thorax_mg, data = butterflies_tidy)#fit linear model

performance::check_model((butterflies_lm8))#check assumptions of lm

summary(butterflies_lm8)#print summary for analysis

broom::tidy(butterflies_lm8, conf.int = TRUE) #add confidence intervals

anova(butterflies_lm8) #perform anova on the model

#_______________________------

# FIGURES ----

## figure 1: jitter plot of inbreeding coefficient vs flight inhibition index ----

figure1 <- ggplot(data = butterflies_tidy, aes(x = factor(inbreed_coeff), y = flight_inhibit_idx)) +
  geom_jitter(aes(color = factor(inbreed_coeff)), width = 0.4, height = 0, alpha = 0.6, size = 2.5) +  #jitter plot
  scale_color_manual(values = c("0" = '#1F9E89', "0.25" = '#31688E', "0.375" = '#440154'),) +  #accessible colours
  labs(title = "Flight Inhibition Index Across Levels of Inbreeding Coefficient", #title
       x = "Inbreeding Coefficient Level", #axis labels
       y = "Flight Inhibition Index",
       colour = "Inbreeding Coefficient") +
  theme_minimal() + 
  scale_y_continuous(breaks = seq(0, ceiling(max(butterflies_tidy$flight_inhibit_idx)), by = 5)) + #y axis line breaks
  theme( panel.grid.major.y = element_line(color = "grey", size = 0.2),  #appearance of line breaks
         panel.grid.minor = element_blank(), #remove minor lines
         legend.title = element_text(size = 12),  #make more aesthetically pleasing
         legend.text = element_text(size = 8),
         axis.title.y = element_text(size=14),
         axis.title.x = element_text(size=14))

# figure 2: summary of linear model ----

figure2 <- broom::tidy(butterflies_lm8, conf.int = TRUE) %>% #tidy and add confidence intervals
  kbl(caption = "Summary of Linear Model", digits = 3) %>% #figure legend
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  kable_styling(bootstrap_options = c("bordered")) #make more aesthetically pleasing


# figure 3: scatter plot of thorax weight vs flight inhibition index ---- 

figure3 <- ggplot(data = butterflies_tidy, aes(x = thorax_mg, y = flight_inhibit_idx)) +
  geom_point(aes(color = factor(inbreed_coeff)), size = 1.8, alpha = 0.85) +  #scatter plot
  geom_smooth(method = "lm", se = FALSE, color = "#440154") +  # Add a regression line
  scale_color_manual(values = c("0" = '#1F9E89', "0.25" = '#6DCD59', "0.375" = '#3E4989')) +  #accessible colours
  labs(title = "Scatter Plot of Thorax Dry Weight vs Flight Inhibition Index", #titles
       x = "Thorax Dry Weight (mg)",
       y = "Flight Inhibition Index",
       colour = "Inbreeding Coefficient") +
  theme_minimal() + 
  scale_y_continuous(breaks = seq(0, ceiling(max(butterflies_tidy$flight_inhibit_idx)), by = 10)) +  #yaxis breaks line breaks
  theme(legend.title = element_text(size = 12),  #make titles more balanced
        legend.text = element_text(size = 10),  
        axis.title.x = element_text(size = 14), 
        axis.title.y = element_text(size = 14)) 

# figure 4: anova table ----

figure4 <- anova(butterflies_lm8) %>%
  as.data.frame() %>%
  `rownames<-`(c("Inbreeding Coefficient", "Thorax Dry Weight (mg)", "Residuals")) %>%
  kbl(caption = "ANOVA Table", digits = 3) %>%
  kable_styling(bootstrap_options = c("striped", "bordered"))

